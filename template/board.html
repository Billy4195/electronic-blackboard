<!DOCTYPE html>
<html>
    <head>
        <title>Board</title>
        <link href={{ static_url("css/template.css")}} rel="stylesheet">
        <script type="text/javascript" src={{ static_url("js/jquery-3.1.1.min.js") }}></script>
    </head>
    <body>
            <div class='container'>
                <center>
                    <img src="#" style="display:none"/>
                </center>
                <div class="title2" style="display:none">
                    <div class="header">
                        <span id="con" >賀 !</span>
                    </div>
                    <div class='content'>
                        <div class='title' id='title1'></div>
                        <div class='title' id='title2'></div>
                        <div id='description'></div>
                        <div id='footer'>
                            <div class='bar'></div>
                            <div class='congratulation'>105年12月 資訊學院全體師生慶賀</div>
                        </div>
                    </div>
                </div>
            </div>
            <script type='text/javascript' src='{{ static_url("js/board_size_reset.js") }}'></script>
        <script>
		var last_schedule_id = "no_id"
		function load_schedule()
		{
			$.ajaxSetup({
			    beforeSend: function (jqXHR, settings)  {
				type = settings.type
				if (type != 'GET' && type != 'HEAD' && type != 'OPTIONS' ) {
				     var pattern = /(.+; *)?_xsrf *= *([^;" ]+)/ ;
				     var xsrf = pattern.exec( document .cookie);
				     if (xsrf) {
					jqXHR.setRequestHeader( 'X-Xsrftoken' , xsrf[ 2 ]);
				    }
				}
			}});
			
			$.ajax({
				url: '/db_schedule',
				type: 'GET',
				contentType : 'application/text',
				success: function (jsonRes) 
				{
                    if(jsonRes.result == "fail"){console.log("fail");}
                    else if(last_schedule_id == jsonRes.schedule_id){console.log("same");}
                    else if(jsonRes.file_type == "text"){
                        console.log("text");
                        last_schedule_id = jsonRes.schedule_id;
                        $('img').css('display','none');
                        $('footer').css('display','inline');
                        $('div.title2').css('display','inline');
                        $('span#con').html(jsonRes.file_text.con);
                        $('#title1').html(jsonRes.file_text.title1);
                        $('#title2').html(jsonRes.file_text.title2);
                        $('#description').html(jsonRes.file_text.description);
                        if(jsonRes.type_name === "獲獎公告"){
                            console.log('reward');
                            $('div.header').css('background-color',jsonRes.file_text.background_color);
                            $('div.bar').css('background-color',jsonRes.file_text.background_color);
                            $('div#footer').css('display','inline');
                            $('div.congratulation').html(jsonRes.file_text.year+"年"+jsonRes.file_text.month+"月 資訊學院全體師生慶賀");
                        }else{
                            $('div.header').css('background-color',jsonRes.file_text.background_color);
                            $('div#footer').css('display','none');
                        }
                    }else{
                        console.log("image");
                        last_schedule_id = jsonRes.schedule_id;
                        $('div.title2').css('display','none');
                        $('img').css('display','inline');
                        $('img').attr('src',"/static/"+jsonRes.file);
                        var width = $('img').width();
                        var height = $('img').height();
                        $('img').height(screen.height * 0.98);
                        $('img').css('maxWidth',($(window).width() * 0.85 | 0 ) + "px");
                    }
				},
				error: function (xhr, textStatus, error) 
				{
					console.log(xhr.statusText);
					console.log(textStatus);
					console.log(error);
					console.log("load_schedule error");
				}
			});
		
		}
	
		function timer()
		{
            load_schedule()
		}
	
	
        $(window).on('load',function(){
            window.setInterval(timer,1000);
        });
        </script>
    </body>
</html>
